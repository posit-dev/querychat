<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Provide Context • querychat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="https://fonts.bunny.net/css?family=Open%20Sans:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&amp;display=auto" rel="stylesheet">
<link href="https://fonts.bunny.net/css?family=Hubot%20Sans:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&amp;display=auto" rel="stylesheet">
<link href="https://fonts.bunny.net/css?family=Source%20Code%20Pro:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&amp;display=auto" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Provide Context">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">querychat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/models.html">Models</a></li>
    <li><a class="dropdown-item" href="../articles/data-sources.html">Data Sources</a></li>
    <li><a class="dropdown-item" href="../articles/context.html">Provide context</a></li>
    <li><a class="dropdown-item" href="../articles/build.html">Build an app</a></li>
    <li><a class="dropdown-item" href="../articles/greet.html">Greet users</a></li>
    <li><a class="dropdown-item" href="../articles/tools.html">Tools</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/querychat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Provide Context</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/querychat/blob/main/vignettes/context.Rmd" class="external-link"><code>vignettes/context.Rmd</code></a></small>
      <div class="d-none name"><code>context.Rmd</code></div>
    </div>

    
    
<p>querychat automatically gathers information about your table to help
the LLM write accurate SQL queries. This includes column names and
types, numerical ranges, and categorical value examples. (All of this
information is provided to the LLM as part of the <strong>system
prompt</strong> – a string of text containing instructions and context
for the LLM to consider when responding to user queries.)</p>
<p>Importantly, we are <strong>not</strong> sending your raw data to the
LLM and asking it to do complicated math. The LLM only needs to
understand the structure and schema of your data in order to write SQL
queries.</p>
<p>You can get even better results by customizing the system prompt in
three ways:</p>
<ol style="list-style-type: decimal">
<li>Add a <a href="#data-description">data description</a> to provide
more context about what the data represents</li>
<li>Add <a href="#extra-instructions">custom instructions</a> to guide
the LLM’s behavior</li>
<li>Use a fully <a href="#custom-template">custom prompt template</a> if
you want complete control (useful if you want to be certain the model
cannot see any literal values from your data)</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://posit-dev.github.io/querychat/pkg-r">querychat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">palmerpenguins</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="default-prompt">Default prompt<a class="anchor" aria-label="anchor" href="#default-prompt"></a>
</h2>
<p>For full visibility into the system prompt that querychat generates
for the LLM, you can inspect the <code>system_prompt</code> field. This
is useful for debugging and understanding exactly what context the LLM
is using:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/querychat-convenience.html">querychat</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">qc</span><span class="op">$</span><span class="va">system_prompt</span><span class="op">)</span></span></code></pre></div>
<p>By default, the system prompt contains the following components:</p>
<ol style="list-style-type: decimal">
<li>The basic set of behaviors and guidelines the LLM must follow in
order for querychat to work properly, including how to use <a href="tools.html">tools</a> to execute queries and update the app.</li>
<li>The SQL schema of the data frame you provided. This includes:
<ul>
<li>Column names</li>
<li>Data types (integer, real, boolean, date/datetime, text)</li>
<li>For text columns with less than 10 unique values, we assume they are
categorical variables and include the list of values</li>
<li>For integer and real columns, we include the range</li>
</ul>
</li>
<li>A <a href="#data-description">data description</a> (if provided via
<code>data_description</code>)</li>
<li>
<a href="#additional-instructions">Additional instructions</a> you
want to use to guide querychat’s behavior (if provided via
<code>extra_instructions</code>).</li>
</ol>
</div>
<div class="section level2">
<h2 id="data-description">Data description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h2>
<p>If your column names are descriptive, querychat may already work well
without additional context. However, if your columns are named
<code>x</code>, <code>V1</code>, <code>value</code>, etc., you should
provide a data description. Use the <code>data_description</code>
parameter for this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/querychat-convenience.html">querychat</a></span><span class="op">(</span></span>
<span>  <span class="va">penguins</span>,</span>
<span>  data_description <span class="op">=</span> <span class="st">"data_description.md"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">qc</span><span class="op">$</span><span class="va">system_prompt</span><span class="op">)</span></span></code></pre></div>
<p>querychat doesn’t need this information in any particular format –
just provide what a human would find helpful:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co">&lt;!-- data_description.md --&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>This dataset contains information about Palmer Archipelago penguins,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>collected for studying penguin populations.</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ss">- </span>species: Penguin species (Adelie, Chinstrap, Gentoo)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ss">- </span>island: Island where observed (Torgersen, Biscoe, Dream)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="ss">- </span>bill_length_mm: Bill length in millimeters</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="ss">- </span>bill_depth_mm: Bill depth in millimeters</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="ss">- </span>flipper_length_mm: Flipper length in millimeters</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="ss">- </span>body_mass_g: Body mass in grams</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="ss">- </span>sex: Penguin sex (male, female)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="ss">- </span>year: Year of observation</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extra-instructions">Additional instructions<a class="anchor" aria-label="anchor" href="#extra-instructions"></a>
</h2>
<p>You can add custom instructions to guide the LLM’s behavior using the
<code>extra_instructions</code> parameter:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/querychat-convenience.html">querychat</a></span><span class="op">(</span></span>
<span>  <span class="va">penguins</span>,</span>
<span>  extra_instructions <span class="op">=</span> <span class="st">"instructions.md"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">qc</span><span class="op">$</span><span class="va">system_prompt</span><span class="op">)</span></span></code></pre></div>
<p>Or as a string:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instructions</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">- Use British spelling conventions</span></span>
<span><span class="st">- Stay on topic and only discuss the data dashboard</span></span>
<span><span class="st">- Refuse to answer unrelated questions</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="va">qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/querychat-convenience.html">querychat</a></span><span class="op">(</span></span>
<span>  <span class="va">penguins</span>,</span>
<span>  extra_instructions <span class="op">=</span> <span class="va">instructions</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">qc</span><span class="op">$</span><span class="va">system_prompt</span><span class="op">)</span></span></code></pre></div>
<div class="alert alert-warning">
<p>LLMs may not always follow your instructions perfectly. Test
extensively when changing instructions or models.</p>
</div>
</div>
<div class="section level2">
<h2 id="custom-template">Custom template<a class="anchor" aria-label="anchor" href="#custom-template"></a>
</h2>
<p>If you want more control over the system prompt, you can provide a
custom prompt template using the <code>prompt_template</code> parameter.
This is for more advanced users who want to fully customize the LLM’s
behavior. See the <a href="../reference/QueryChat.html">QueryChat
reference</a> for details on the available template variables.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://garrickadenbuie.com" class="external-link">Garrick Aden-Buie</a>, <a href="https://github.com/jcheng5" class="external-link">Joe Cheng</a>, <a href="https://cpsievert.me" class="external-link">Carson Sievert</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
